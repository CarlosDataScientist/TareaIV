---
header-includes:
- \usepackage{enumitem}
- \usepackage{amsmath}
- \usepackage{float}
- \usepackage{pdfpages}
- \usepackage{caption}
- \usepackage[spanish]{babel}\decimalpoint
output:
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=T, message=FALSE, warning=FALSE, 
                       fig.align='center', eval=T)
```


Realice los siguientes ejercicios con el equipo señalado.

**1. Resuelva los ejercicios 10.4 y 10.5 (5a edición). Realice estos con ayuda de su laboratorista y entregue las soluciones escritas a máquina, utilizando LaTeX. [1 hora, 1 punto cada pregunta]**

**2. Estudie el financiamiento del sistema bancario en México a la luz del concepto de "transformación de madurez": [2 horas, 1 puntos cada inciso]**

**(a) Obtenga, del SIE/Financiamiento e información financiera de intermediarios financieros/ del Banco de México, información de las formas de financiamiento del sector bancario (comercial) mexicano, y haga gráficas describiendo la evolución en el tiempo de las distintas tipos de financiamiento (depósitos a la vista, financiamiento de mercado y otros) y de la proporción que cada uno representa del total. Es decir, hay que producir dos gráficas de series de tiempo en la que el valor total está constituido por varias partes intermedias.**

Para la siguiente respuesta se utiliza la serie `Principales Activos y Pasivos de la banca comercal (metodología 2018)`. La pregunta habla acerca de los depósitos a la vista y el financiamiento de mercado. Entendemos como depósitos a la vista aquellos que son de exigibilidad inmediata, mientras que excluimos de esta tipificación los depósitos a plazo. Por otro lado, definimos el financiamiento de mercado aquel que no incluya al sector público, excluyendo también a las empresas productivas del estado o empresas de participación estatal y órganos decentralizados. Se presenta una tabla con la tipificación que se acaba de definir con el nombre y número de series de banxico.

```{r, echo=FALSE}
clase <- c('d.1 Sector privado no bancario residente',
            'd.2 Banca de desarrollo',
            'd.3 Otros intermediarios financieros públicos',
            'd.4 Sector público no financiero',
            'd.5 Sector no residente')
tipo <- paste('d.', rep(1:5,  2), c(rep('.1 De exibilidad inmediata',5), rep('.2 A plazo',5)), sep = '')
Nombres <- paste('d Captación', clase, tipo, sep = ' - ')
series.exigibilidad <- c('SF320773','SF320776','SF320779','SF320782', 'SF320785')
series.plazo <- c('SF320774','SF320777','SF320780','SF320783', 'SF320786')
Serie <- c(series.exigibilidad, series.plazo)
Sector <- rep(c('Privado', rep('Público', 3), 'Privado'),2)
Tipo <- c(rep('A la vista', 5), rep('A plazo', 5))
tipificacion <- data.frame(Sector, Tipo, Serie, Nombres)
knitr::kable(tipificacion, caption = 'Tipificación')
```

A continuación se presentan las gráficas. 

```{r, echo=FALSE}
# Abrir sesión en API banxico
tkn <- "8bd93af99a69ac4062f645fd43e0b517c5c88bb17750149a9fce21e47f8264af"
siebanxicor::setToken(tkn)
series <- siebanxicor::getSeriesData(Serie, '2009-07-01','2022-03-01')
j = 1
for (i in match(names(series),Serie)) {
  a <- matrix(unlist(series[[j]][2]), ncol = 1)
  a <- cbind(a, rep(Serie[i], length(a)))
  if (j == 1) {
    b <- matrix(unlist(series[[j]][1]), ncol = 1)
    ds <- cbind(b,a)
    colnames(ds) <- c('Fecha' , 'Valor (miles)', 'Serie')
    j = j + 1
    next
  }
  a <- cbind(b,a)
  ds <- rbind(ds,a)
  j = j + 1
}
ds <- data.frame(ds)
ds[,2] <- as.numeric(ds[,2])
ds[,1] <- as.POSIXct.Date(as.numeric(ds[,1])+ 0.5)
ds.etl <- (merge(x = ds, y = tipificacion[,-4], by = 'Serie'))[,c(2,3,4,5)]
colnames(ds.etl)[2] <- 'Valor (miles)'
```

```{r, echo=FALSE, include=FALSE}
table.1 <- dplyr::summarise(dplyr::group_by(ds.etl, Fecha, Sector, Tipo),
                            `Depositos` = sum(`Valor (miles)`)/1000000)
table.1 <- as.data.frame(table.1)
table.1[,5] <- paste(table.1[,2], table.1[,3])
colnames(table.1)[5] <- 'Clase'
table.1 <- table.1[,c(1,5,4)]
plot.1 <- ggplot2::ggplot(table.1,  ggplot2::aes(x = Fecha, 
                                                y = `Depositos`, 
                                                fill = Clase)) + 
  ggplot2::geom_area() + ggplot2::theme(legend.position="bottom") +
  ggplot2::labs(title = 'Captación Bancaria (comercial)',
                subtitle = 'En miles de millones de pesos nominales',
                y = '$',
                x = 'Año',
                caption = 'Fuente: Elaboración propia con datos del SIE/BANXICO')
```
```{r, echo=FALSE}
plot.1
```



**(b) Obtenga de la misma fuente información del tipo de créditos que el sistema bancario (comercial) mexicano otorga, y haga gráficas describiendo la evolución en el tiempo de distintos tipos de crédito y de la proporción que cada uno representa del total. Al igual que en el inciso anterior, hay que producir dos gráficas de series de tiempo en la que el valor total está constituido por varias partes intermedias.**


**(c) Explique si los datos son consistentes con la hipótesis de que los bancos hacen transformación de madurez o si no lo son y porqué. Para ello posiblemente tenga que hacer supuestos (razonables) o buscar información adicional acerca de la madurez de los distintos tipos de financiamiento y crédito otorgado.**


**(d) Explique qué implica la evolución de las formas de financiamiento y los tipos de crédito otorgados que observó en los incisos anteriores para la estabilidad del sistema financiero a la luz del modelo Diamond-Dybvig.**


**(e) A propósito, documente el incremento dramático a lo largo del tiempo en el crédito hipotecario como proporción del PIB.**



# Ejercicio 3 

**Estudie al gobierno mexicano y a los corporativos mexicanos desde el punto de vista de su endeudamiento [1 hora, 1 punto cada inciso]:**

```{r librerias, echo=FALSE}
#Librerias Necesarias
pacman::p_load(ggplot2,dplyr)
```


## (a) Utilice datos del SIE/Valores en Circulación y de SIE/Finanzas públicas del Banco de México para describir la evolución a lo largo del tiempo de la composición de la deuda del gobierno mexicano por tipo de instrumento, madurez y moneda. Señale la implicación de lo que encuentre para el riesgo de impago.

Con base en los datos obtenidos del SIE del Banco de México, se tiene que la deuda del gobierno mexicano por tipo de instrumento tiene la siguiente composición:

```{r, echo=FALSE,out.width="450px", out.height="350px"}
instrumentos<-read.csv("https://raw.githubusercontent.com/JobGV/Auxiliar/main/InstrumentosGobierno.csv")
instrumentos[,-c(1,2)]<-instrumentos[,-c(1,2)]/instrumentos$TOTAL

fechas<-instrumentos$Fecha %>% as.Date("%d/%m/%Y")

cetes<-instrumentos$CETES
bondes<-instrumentos$BONDES
bondesd<-instrumentos$BONDESD
bondesf<-instrumentos$BONDESF
udibonos<-instrumentos$UDIBONOS
bonos<-instrumentos$BONOS
Etiqueta<-c(rep("CETES",267),rep("BONDES",267),rep("BONDES D",267),
            rep("BONDES F",267),rep("UDIBONOS",267),rep("BONOS",267))
Valores<-c(cetes,bondes,bondesd,bondesf,udibonos,bonos)

datos<-data.frame(FECHA=rep(fechas,6),INSTRUMENTO=Etiqueta,SALDO=Valores)


ggplot(datos, aes(x=FECHA, y=SALDO, fill=INSTRUMENTO)) + 
  geom_area()+
  theme_classic()+
  scale_fill_manual(" ", values = c("BONDES" = "#4A0A5D", "BONDES D" = "#00558A", "BONDES F" = "black","BONOS"="#009F94","CETES"="#79D359","UDIBONOS"="#FDE333"))+
xlab("")+ylab("%")+ggtitle("Composición de la deuda del gobierno mexicano por tipo de instrumento")+ theme(legend.position="bottom")

#Inciso c
datos<-datos %>% filter(FECHA>="2019-01-01",INSTRUMENTO!="BONDES")
p1<-ggplot(datos, aes(x = FECHA, y = SALDO)) +
  geom_line(aes(color = INSTRUMENTO), size = 1) +
  theme_minimal()+
  scale_color_manual("",values=c("BONDES D" = "#00558A", "BONDES F" = "black","BONOS"="#009F94","CETES"="#79D359","UDIBONOS"="#4A0A5D"))+
  xlab("")+ylab("%")+ggtitle("Composición de la deuda del gobierno mexicano por tipo de instrumento")+ geom_vline(xintercept = as.numeric(as.Date("2020-04-01")),color="red",size=1)+ theme(legend.position="bottom")

```

Del cuadro anterior se puede observar los siguiente: 

* Los BONDES dejaron de ser emitidos a partir del 01/05/2010
* La emisión de BONDES D inició el 01/08/2006
* La emesión de BONDES F inició el 01/10/2021
* Actualemente los bonos son el instrumento que tienen mayor participación en la deuda del gobierno mexican; mientras que, los BONDES F tienen la menor participación.

Sobre la madurez de la deuda del gobierno mexicano se tiene la siguiente figura: 

```{r, echo=FALSE,out.width="350px", out.height="350px"}
madurez<-read.csv("https://raw.githubusercontent.com/JobGV/Auxiliar/main/MadurezGobierno.csv")
fechas<-madurez$Fecha %>% as.Date("%d/%m/%Y")
Etiqueta<-c(rep("Corto Plazo",154),rep("Largo Plazo",154))
Valores<-c(madurez$CP,madurez$LP)

datos<-data.frame(FECHA=rep(fechas,2),Temporalidad=Etiqueta,Porcentaje=Valores)


ggplot(datos, aes(x=FECHA, y=Porcentaje, fill=Temporalidad)) + 
  geom_area()+
  theme_classic()+
  scale_fill_manual(" ", values = c("Corto Plazo" = "#4A0A5D", "Largo Plazo" = "#009F94"))+
  xlab("")+ylab("%")+ggtitle("Composición de la deuda del gobierno mexicano por madurez")+theme(legend.position="bottom")

#Inciso c
datos<-datos %>% filter(FECHA>="2019-01-01")
p2<-ggplot(datos, aes(x = FECHA, y = Porcentaje)) +
  geom_line(aes(color = Temporalidad), size = 1) +
  theme_minimal()+
  scale_color_manual(" ", values = c("Corto Plazo" = "#4A0A5D", "Largo Plazo" = "#009F94"))+
  xlab("")+ylab("%")+ggtitle("Composición de la deuda del gobierno mexicano por madurez")+ geom_vline(xintercept = as.numeric(as.Date("2020-04-01")),color="red",size=1)+ theme(legend.position="bottom")

```

Notemos que la deuda del gobierno mexicano es en su mayoría de largo plazo, este comportamiento ha sido persistente a largo del tiempo. 

Respecto a la deuda interna y externa se tiene el siguiente gráfico:

```{r, echo=FALSE,out.width="350px", out.height="350px"}
deuda<-read.csv("https://raw.githubusercontent.com/JobGV/Auxiliar/main/DeudaGobierno.csv")
fechas<-deuda$Fecha %>% as.Date("%d/%m/%Y")
Etiqueta<-c(rep("Interna",266),rep("Externa",266))
Valores<-c(deuda$I,deuda$E)
datos<-data.frame(FECHA=rep(fechas,2),Tipo=Etiqueta,Porcentaje=Valores)
ggplot(datos, aes(x=FECHA, y=Porcentaje, fill=Tipo)) + 
  geom_area()+
  theme_classic()+
  scale_fill_manual("", values = c("Interna" = "#4A0A5D", "Externa" = "#009F94"))+
  xlab("")+ylab("%")+ggtitle("Composición de la deuda neta del sector público")+theme(legend.position="bottom")


#para inciso c

datos<-datos %>% filter(FECHA>="2019-01-01")
p5<-ggplot(datos, aes(x = FECHA, y = Porcentaje)) +
  geom_line(aes(color = Tipo), size = 1) +
  theme_minimal()+
  scale_color_manual("", values = c("Interna" = "#4A0A5D", "Externa" = "#009F94"))+
  xlab("")+ylab("%")+ggtitle("Composición de la deuda neta del sector público")+ geom_vline(xintercept = as.numeric(as.Date("2020-04-01")),color="red",size=1)+theme(legend.position="bottom")


```

Notemos que la deuda externa está en moneda extranjera, por lo que una depreciación de la moneda local podría ser un factor de riesgo de impago. En México la deuda interna es mayor que la externa. 

## (b)  Utilice datos del SIE/Valores en Circulación o para describir la composición a lo largo del tiempo de la deuda del sector privado no financiero mexicano por madurez y moneda. Señale la implicación de lo que encuentre para el riesgo de impago.

La deuda del sector privado no financiero mexicano por madurez se compone de la siguiente manera: 

```{r, echo=FALSE,out.width="350px", out.height="350px"}
Privadas<-read.csv("https://raw.githubusercontent.com/JobGV/Auxiliar/main/PrivadaNoFin.csv")
fechas<-Privadas$Fecha %>% as.Date("%d/%m/%Y")
Etiqueta<-c(rep("Corto Plazo",154),rep("Largo Plazo",154))
Valores<-c(Privadas$CP,Privadas$LP)
datos<-data.frame(FECHA=rep(fechas,2),Temporalidad=Etiqueta,Porcentaje=Valores)

ggplot(datos, aes(x=FECHA, y=Porcentaje, fill=Temporalidad)) + 
  geom_area()+
  theme_classic()+
  scale_fill_manual(" ", values = c("Corto Plazo" = "#4A0A5D", "Largo Plazo" = "#009F94"))+
  xlab("")+ylab("%")+ggtitle("Composición de la deuda del sector privado no financiero por madurez")+ theme(legend.position="bottom")

#Para c
datos<-datos %>% filter(FECHA>="2019-01-01")
p3<-ggplot(datos, aes(x = FECHA, y = Porcentaje)) +
  geom_line(aes(color = Temporalidad), size = 1) +
  theme_minimal()+
  scale_color_manual(" ", values = c("Corto Plazo" = "#4A0A5D", "Largo Plazo" = "#009F94"))+
  xlab("")+ylab("%")+ggtitle("Composición de la deuda del sector privado no financiero por madurez")+ geom_vline(xintercept = as.numeric(as.Date("2020-04-01")),color="red",size=1)+ theme(legend.position="bottom")


```

Notemos que la deuda del sector privado no financiero mexicano está compuesta principalmente por deuda de largo plazo (deuda a más de 365 días). El riesgo de impago en esta situación se puede dar debido a que algunas empresas quiebren antes de saldar sus deudas.


La deuda del sector privado no financiero mexicano por tipo de moneda se compone de la siguiente manera: 

```{r, echo=FALSE,out.width="350px", out.height="350px"}
Etiqueta<-c(rep("Local",154),rep("Extranjera",154))
Valores<-c(Privadas$L,Privadas$E)
datos<-data.frame(FECHA=rep(fechas,2),Moneda=Etiqueta,Porcentaje=Valores)
ggplot(datos, aes(x=FECHA, y=Porcentaje, fill=Moneda)) + 
  geom_area()+
  theme_classic()+
  scale_fill_manual("", values = c("Local" = "#009F94", "Extranjera" = "#4A0A5D"))+
  xlab("")+ylab("%")+ggtitle("Composición de la deuda del sector privado no financiero por moneda")+ theme(legend.position="bottom")

#Para c
datos<-datos %>% filter(FECHA>="2019-01-01")
p4<-ggplot(datos, aes(x = FECHA, y = Porcentaje)) +
  geom_line(aes(color = Moneda), size = 1) +
  theme_minimal()+
  scale_color_manual("", values = c("Local" = "#009F94", "Extranjera" = "#4A0A5D"))+
  xlab("")+ylab("%")+ggtitle("Composición de la deuda del sector privado no financiero por moneda")+ geom_vline(xintercept = as.numeric(as.Date("2020-04-01")),color="red",size=1)+ theme(legend.position="bottom")



```

Con base en el gráfico anterior, la deuda del sector privado no financiero mexicano está compuesta en su mayoria por moneda local. Sin embargo, hay un porcentaje de deuda en moneda extranjera que puede ser la causa del riesgo de impago, esto podría ocurrir si la moneda extranjera se aprecia y la deuda crece de tal forma que la empresa ya no pueda liquidarla.


## (c) Describa la evolución de las cifras anteriores durante la pandemia de Covid-19, es decir entre principios de 2020 y hasta la fecha.

Para este ejercicio supondremos que el inicio de la pandemia en México fue el 30 de marzo de 2020 cuando el Consejo de Salubridad General decreta emergencia sanitaria por el virus SARS-CoV-2. Este decreto, cerró buena parte de los servicios de los gobiernos de todos los niveles, así como de los otros poderes de la Unión: Judicial y Legislativo.


Veamos los efectos que tuvo la pandemia en la composición de la deuda del gobierno mexicano: 

```{r, echo=FALSE,out.width="350px", out.height="350px"}
p1
p2
p5
```
Respecto a la composición por instrumentos se tienen los siguientes resultados: 

* 2020-2021
  + El peso de los bonos en la deuda disminuyó
  + El peso de los cetes en la deuda aumentó
  + El peso de los udibonos y bondes D permanecieron estables
* 2021-2022
  + El peso de los bonos en la deuda disminuyó
  + El peso de los cetes en la deuda permaneció estable con una caída al final del año
  + El peso de los udibonos en la deuda aumentó 
  + El peso de los bondes D en la deuda aumentó y tuvo una caída a final del año

En relación a la madurez de la deuda del gobierno mexicano podemos observar que aumentó la deuda a corto plazo y diminuyó la de largo plazo, lo anterior se puede ver como una señal de blindaje ante la incertidumbre de la situación sanitaria. 

En cuanto a la composición de la deuda neta del sector público podemos observar que la deuda interna tiene una tendencia creciente desde el 30 de marzo de 2020, mientras que la deuda externa tiene una tendencia decreciente. 

Ahora veamos los efectos que tuvo la pandemia en la composición de la deuda del sector privado no financiero mexicano:
```{r, echo=FALSE,out.width="350px", out.height="350px"}
p3
p4
```

Notemos que la composición de la deuda del sector privado no financiero mexicano cambió en su estructura después del decreto de emergencia sanitaria por el virus SARS-CoV-2.

+ La deuda de corto plazo aumentó, mientras que la deuda de largo plazo disminuyó
+ La deuda en moneda extranjera aumentó, pero no fue instantáneo el cambio sino que ocurrió a finales del año

Lo anterior nos permite observar como el sector privado se protegió ante la situación sanitaria aumentando su deuda a corto plazo y no adquiriendo deuda en moneda extranjera para protegerse de una posible depreciación de la moneda local. 





**4. Proponga una mejora al archivo Diccionario de Economía utilizando github.**